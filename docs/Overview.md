# 設計の概要

## FX自動取引の流れ

自動取引は以下の流れに従って実行される。以下の流れはある通貨市場について、
売り/買いのうちどちらか一方のポジションのみを保有することを前提とする。
(OANDAのAPI上逆のポジションは保有できないため)

1. 売買シグナルを監視するパターン分析を実行する
2. パターンが確認された場合、売買シグナルとしてシステムに通知する
3. 売買シグナルを受信したシステムはシグナルが発生した市場に対し...
	1. ポジションを持っていない場合は新しくポジションを建てる
	2. ポジションを持っている場合はシグナルを無視する(ポジションを建てる際に発生するラグを考慮する)
4. ポジションを建てる際、発生したシグナルに応じて当該市場のパターン分析を手仕舞い用に移行する
5. ポジションを保有している場合、以下のいずれかの条件を満たす場合は当該市場のポジションを手仕舞いする
	- ルール1: 事前に設定したリスクを超えて損失を出した場合
	- ルール2: 事前に設定した想定時間を超えて決裁していない場合
	- ルール3: 上記2つの基準を特定のタイミング毎に更新する
6. 手仕舞いシグナルを受信したシステムはシグナルが発生した市場に対し...
	1. ポジションを持っていない場合はシグナルを無視する(ポジションを手仕舞う際に発生するラグを考慮する)
	2. ポジションを持っている場合は手仕舞いを行う
7. 手仕舞いが完了後、当該市場のパターン分析を売買シグナル監視用に移行する

## パターンの分析

プログラムは取引対象とする市場について条件に基づいてパターンの分析を行う。

パターン分析は以下に考慮される特定の条件を満たした場合に実施する
- 特定の時間に達した場合(0分に達した場合等)
- 市場が特定のパターンを示した場合(一定期間に想定以上の金額が上下した場合等)

パターン分析は分析方法に応じたタイミングで発動するように設定可能とする
また、パターンは売買シグナル・手仕舞いタイミングの監視用に動的に設定ができるものとする

## ポジションサイジング

ポジションを建てる際、自分の取れるリスクに応じて取引数量を決定する
リスクの算出方法は(シグナルを発生させた)売買戦略毎に設定が可能であるものとする
また、目標とする金額・条件は手仕舞いタイミング用のパターン分析で監視する
